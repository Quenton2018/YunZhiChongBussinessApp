<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>主页</title>
	<link rel="stylesheet" href="css/mui.min.css" />
	<link rel="stylesheet" href="css/common.css" />
	<link rel="stylesheet" href="plugins/layer/theme/default/layer.css" />
	<style>
		.header {
			box-shadow: none;
		}
		.header {
		    padding-bottom: 44px;
		    background-image: -moz-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
		    background-image: -webkit-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
		    background-image: -ms-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
		}
		.header .mui-title,
		.header .mui-icon {
			color: #FFFFFF;
		}
		.box01{
            height: 230px;
            background: url("images/index/beijing@3x.png") no-repeat;
            background-size: 100% 100%;
            text-align: center;
            padding-top: 40px;
        }
        .box01 h1{
            margin: 0;
            padding: 0;
            color: white;
            font-size:36px;
        }
        .box01 h2{
            margin: 0;
            padding: 0;
            margin-top: 10px;
            padding-left: 30px;
            color: white;
            font-size: 15px;
            line-height: 20px;
            background: url("images/index/shouru@3x.png")  35% center no-repeat;
            background-size: 25px 20px;
        }
        .box01 .conbox01{
            margin-top: 50px;
            float: left;
            width: 50%;
            text-align: center;
        }
        .conbox01 h3{
            font-size: 24px;
            color: white;
        }
        .conbox01 h4{
            margin-top: 10px;
            font-size: 13px;
            color: white;
        }
        
        a img {
        	width: 44px;
        }
	</style>
</head>

<body style="background-color: #FFFFFF;">

	<header class="header header-immersed mui-bar mui-bar-nav">
	    <a class="mui-icon mui-icon-person" id="userInfo"></a>
	    <h1 class="mui-title">云智充</h1>
	    <a class="mui-icon mui-icon-gear mui-icon-right-nav mui-pull-right" onclick="clicked('page/setting.html')"></a>
	</header>
	
	<div class="mui-content">
		<!-- box01 -->
		<div class="box01">
	        <h1 class="totalMoney">0.00</h1>
	        <h2>收入总计(元)</h2>
	        <div class="conbox01">
	            <h3 class="dayMoney">0.00</h3>
	            <h4>今日总收入(元)</h4>
	        </div>
	        <div class="conbox01">
	            <h3 class="cdzCount">0</h3>
	            <h4>充电桩总数(台)</h4>
	        </div>
	        <div class="clearfix"></div>
	    </div>
		
        <ul class="mui-table-view mui-grid-view mui-grid-9" style="background-color: #FFFFFF;">
            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
            	<a onclick="clicked('page/myCdz.html')">
                    <img src="images/index/wodecdz@3x.png">
                    <div class="mui-media-body">我的充电桩</div>
            	</a>
            </li>
            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
            	<a onclick="clicked('page/myIncome.html')">
                    <img src="images/index/wodeshouru@3x.png">
                    <div class="mui-media-body">我的收入</div>
            	</a>
            </li>
            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
            	<a onclick="clicked('page/myWallet.html')">
                    <img src="images/index/wodeqianbao@3x.png">
                    <div class="mui-media-body">我的钱包</div>
            	</a>
            </li>
            <li style="display: none;" id="areaApplicationList" class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
            	<a onclick="clicked('page/areaApplicationList.html')">
                    <img src="images/index/pianqushenqing@3x.png">
                    <div class="mui-media-body">片区申请</div>
            	</a>
            </li>
            <li style="display: none;" id="applyCdz" class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
            	<a onclick="clicked('page/applyCdz/list.html')">
                    <img src="images/index/cdzsq@3x.png">
                    <div class="mui-media-body">充电桩申请</div>
            	</a>
            </li>
        </ul> 
	</div>
	
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="plugins/layer/layer.js"></script>
	<script src="js/hammer.min.js"></script>
	<script src="js/jquery.hammer.js"></script>
	<script src="js/common.js"></script>
	<script src="js/base.js"></script>
    <script src="js/mui.min.js"></script>
    <script>
    	mui.init();
    	
    	$.plusReady(function() {
    		checkLogin('page/login.html');
    		
            getUserInfo();
            GetADaylyIncomeDetail();
            
            // 热更新
        	heatUpdate(plus.os.name);

            checkVersion();
    	}, function() {
    		getUserInfo();
            GetADaylyIncomeDetail();
    	});
    	
    	var userInfo = document.getElementById('userInfo');
    	userInfo.addEventListener('click', function() {
    		// mui('#offCanvasWrapper').offCanvas().show();
    		clicked('page/menu.html');
    	}, false);
    	
    	/**
         * 获取用户信息
         */
       	function getUserInfo(){
            var uuid = plus.storage.getItem("uuid");
            if(!vaildeParam(uuid)){
                return;
            }
            if(vaildeParam(uuid)){
                postJSON(API_URL.ApiAdminInfo,{"uuid":uuid},function(res){
                    if("0" == res.code){

                        console.log(JSON.stringify(res))

                        var mobile = res.data.username;
                        var headImage = res.data.headImage;
                        var nickname = res.data.realname;
                        var phone = res.data.mobile;
                        var bankCode = res.data.bankCode;
                        var bank = res.data.bank;
                        var moneyAmount = res.data.moneyAmount;
                        var userType = res.data.userType;
                        var totalIncome = res.data.totalIncome;
                        if("1"==userType){
                            $("#areaApplicationList").css("display","inline-block");
                            $("#applyCdz").css("display","inline-block");
                        }
                        plus.storage.setItem( "mobile", mobile);
                        plus.storage.setItem( "headImage", headImage);
                        plus.storage.setItem( "nickname", nickname);
                        plus.storage.setItem( "phone", phone);
                        plus.storage.setItem( "bankCode", bankCode);
                        plus.storage.setItem( "bank", bank);
                        plus.storage.setItem( "moneyAmount", moneyAmount);
                        plus.storage.setItem( "totalIncome", totalIncome+'');
                        plus.storage.setItem( "userType", userType);

                        console.log("totalIncome : "+totalIncome)

					 	if (!vaildeParam(totalIncome)) {
					 	    totalIncome = 0;
				        }

                        $(".totalMoney").text(totalIncome.toFixed(2));

                    }else{
                        layer.msg(res.msg);
                        clearLogin();
                        clicked("page/login.html");
                    }
                })
            }
        }
		

        /**
         * 获取今日收入 充电桩总台数
         */
        function GetADaylyIncomeDetail(){
            var uuid = plus.storage.getItem("uuid");
            if(!vaildeParam(uuid)){
                return;
            }
            if(vaildeParam(uuid)){
                postJSON(API_URL.ApiChargingBusinessGetADaylyIncomeDetail,{"uuid":uuid},function(res){
                    if("0" == res.code){
                        var parnterMoneyToTal = res.data.parnterMoneyToTal;
                        var countAll = res.data.countAll;
						if (!vaildeParam(parnterMoneyToTal)) {
					           parnterMoneyToTal = 0;
				        }
                        $(".dayMoney").text(parnterMoneyToTal.toFixed(2));
                        $(".cdzCount").text(res.data.countAll);
                    }else{
                        layer.msg(res.msg);
                        clearLogin();
                        clicked("page/login.html");
                    }
                })
            }
        }



        /**
         * 检查版本
         */
        function checkVersion() {
            var osName = plus.os.name;
            var version = appVersion;

            postJSON(API_URL.AppVersionPartnerGetNewest,{"appType":osName},function (res) {

                if('0' == res.code){
                    if(vaildeParam(res.data)){
                        var v = res.data.version;
						
						if (compareVersion(res.data.version)) {
							clicked("page/edition.html");
						}
                    }
                }
            })
        }
        
        
    </script>
</body>
</html>