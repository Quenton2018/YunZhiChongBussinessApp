<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>主页</title>
	<link rel="stylesheet" href="css/mui.min.css">
	<link rel="stylesheet" href="css/iconfont.css">
	<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8"/>
	<link rel="stylesheet" href="plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="plugins/layer/layer.js"></script>
	<script src="js/hammer.min.js"></script>
	<script src="js/jquery.hammer.js"></script>
	<script src="js/common.js"></script>
	<script src="js/base.js"></script>
    <script src="js/mui.min.js"></script>
    <style type="text/css">
        .myHead{
            background:transparent;
            box-shadow:none;
            color: #fff;
            margin-top: 5px;
        }
        .myHead a{
            color: #fff;
        }

        .myNavBox{
            padding: 2rem;
        }
        .myNavBox img{
            vertical-align:middle;
            width: 50px;
            display: inline-block;
            margin-right: 15px;
        }
        .myNavBox .myNavItem{
            padding-top: 50px;
        }

    </style>

</head>
<body style="background: #fff">

    <header class="mui-bar mui-bar-nav myHead" onclick="clicked('page/menu.html')">
        <a class="mui-pull-left" style="line-height: 44px;" >
            <img src="images/app_10.png" id="head-img"  style="display: inline-block;width: 38px;height: 38px;vertical-align: middle   ; border-radius: 50%;">
            <span id="mobileBox" style="display: inline-block"></span>
        </a>
        <h1 class="mui-title">&nbsp;</h1>
        <a id="info" class="mui-pull-right" style="line-height: 54px;">
          <!--  <img src="images/xiaoxi.png" style="width: 20px">-->
        </a>
    </header>

    <div class="mui-content" style="padding-top: 0;background: #fff">
        <!--<img src="images/rongyubang.png" style="display: block;width: 100%"/>  &lt;!&ndash;onclick="clicked('page/honorList.html')"&ndash;&gt;-->
        <img src="images/menu/home.png" style="display: block;width: 100%"/>  <!--onclick="clicked('page/honorList.html')"-->

        <div class="myNavBox">

            <div class="myNavItem" onclick="clicked('page/myCdz.html')" >
                <img src="images/cdz.png"> 我的充电桩
            </div>
            <div class="myNavItem" onclick="clicked('page/myIncome.html')">
                <img src="images/shouru.png" > 我的收入
            </div>
            <div class="myNavItem" onclick="clicked('page/myWallet.html')">
                <img src="images/qianbao.png" > 我的钱包
            </div>
        </div>

    </div>

	<script type="text/javascript">
        mui.init();

        var ws=null;
        // 处理沉浸式状态栏
        var topoffset=0;
        var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
        if(ms&&ms.length>=3){
            topoffset=parseFloat(ms[2]);
        }

        if(window.plus){
            pagePlusReady();
        }else{
            document.addEventListener('plusready',pagePlusReady,false);
        }

        function pagePlusReady(){
            checkLogin('page/login.html');
            var uuid = plus.storage.getItem("uuid");
            if(!vaildeParam(uuid)){
                return;
            }

            var mobile = plus.storage.getItem("mobile");
            var headImage = plus.storage.getItem("headImage");
            mobile  = mobile.substr(0, 3) + '****' + mobile.substr(7);
            $("#mobileBox").text(mobile);
            if(vaildeParam(headImage)){
                console.log("## headImage ## : "+headImage);
                document.getElementById('head-img').src = headImage;
            }

            getUserInfo();

            checkVersion();

            plus.push.addEventListener( "receive", function( msg ) {
                layer.msg(msg);
            }, false );

            ws=plus.webview.currentWebview();
            if(plus.navigator.isImmersedStatusbar()){// 兼容沉浸式状态栏模式
                topoffset=Math.round(plus.navigator.getStatusbarHeight());
            }
            ws.setPullToRefresh({support:true,style:'circle',offset:topoffset+45+'px'},onRefresh);
        }

        // 刷新页面
        function onRefresh(){
            getUserInfo();
            ws.endPullToRefresh();
        }


        /**
         * 检查版本
         */
        function checkVersion() {
            var osName = plus.os.name;
            var version = appVersion;

            postJSON(API_URL.AppVersionPartnerGetNewest,{"appType":osName},function (res) {

                if('0' == res.code){
                    if(vaildeParam(res.data)){

                        var v = res.data.version;
                        console.log("v:"+v);
                        if(version != v){
                            clicked('page/edition.html')
                        }
                    }
                }
            })
        }

        /**
         * 获取用户信息
         */
       function getUserInfo(){
            var uuid = plus.storage.getItem("uuid");
            if(!vaildeParam(uuid)){
                return;
            }
            if(vaildeParam(uuid)){
                postJSON(API_URL.ApiAdminInfo,{"uuid":uuid},function(res){
                    if("0" == res.code){
                        var mobile = res.data.username;
                        var headImage = res.data.headImage;
                        var nickname = res.data.realname;
                        var phone = res.data.mobile;
                        var bankCode = res.data.bankCode;
                        var bank = res.data.bank;
                        var moneyAmount = res.data.moneyAmount;

                        plus.storage.setItem( "mobile", mobile);
                        plus.storage.setItem( "headImage", headImage);
                        plus.storage.setItem( "nickname", nickname);
                        plus.storage.setItem( "phone", phone);
                        plus.storage.setItem( "bankCode", bankCode);
                        plus.storage.setItem( "bank", bank);
                        plus.storage.setItem( "moneyAmount", moneyAmount);
                        console.log("moneyAmount"+moneyAmount);
                        mobile  = mobile.substr(0, 3) + '****' + mobile.substr(7);
                        $("#mobileBox").text(mobile);
                        if(vaildeParam(headImage)){
                            console.log("## headImage ## : "+headImage);
                            document.getElementById('head-img').src = headImage;
                        }
                    }else{
                        layer.msg(res.msg);
                        clearLogin();
                        clicked("page/login.html");
                    }
                })
            }
        }

	</script>
</body>
</html>