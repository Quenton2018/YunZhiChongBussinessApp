<!DOCTYPE html>
<html>
	<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>编辑片区申请</title>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/mui.picker.min.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="../plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/hammer.min.js"></script>
    <script src="../js/jquery.hammer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/mui.min.js"></script>
    <script src="../js/mui.picker.all.js"></script>
    <script src="../js/artTemplate.min.js"></script>
    <style type="text/css"> 	
    	.setmeal_wrap{
    		/*display: none;*/
    	}
		.setmeal_box{
			padding: 10px;
		}

		.charges_tap{
			margin: 0 30px 10px;
			border: 1px solid #ff6d22;
			border-radius: 6px;
		}
		.tap_list{
			width: 50%;
		    padding: 10px 0;
		    text-align: center;
		}
		.tap_list.select{
			background: #ff6d22;
			color: #FFF;
		}
		.setmeal_content{
			padding: 15px 10px;
			background: #fff;
			border-radius: 6px;
			margin-bottom: 10px;
		}
		.setmeal_title{
			color: #4d4d4d;
			font-size: 1rem;
			font-weight: 400;
			/*padding-left: 10px;*/
		}
		.setmeal_title:before{
			border-left: 5px solid #ff6d22;
			border-radius: 2px;
			content: '';
			margin-right: 6px;
		}
    	.setmeal_tap_header{
    		padding: 15px 40px 15px 5px;
    		overflow: hidden;	
    	}
    	.setmeal_tap_header span{  		
    		text-align: center;
    		font-size: 1rem;
    		width: 120px;
    		display: inline-block;
    	}
    	.setmeal_tap_header span i{
    		font-size: 0.8rem;
    		color: #acacac;
    		font-style: normal;
    	}
    	.table_ul{
    		padding: 0 40px 0 5px;
    		margin: 0;
    		margin-top: -15px;
    	}
    	.table_list{
    		padding: 12px 0;
    		border-bottom: 1px dashed #808080;
    		list-style: none;
    		overflow: hidden;
    	}
    	.table_list:last-child{
    		border-bottom: none;
    	}
    	.table_list span{
    		text-align: center;
    		font-size: 16px;
    	}
		.table_list span.first_span{
    		text-align: left;
    		padding-left: 10px;
    	}

    	.table_list span.circle {
			width: 16px;
			height: 16px;
			line-height: 14px;
			border-radius: 50%;
			box-sizing: border-box;
			border: 1px solid #ff6d22;
			text-align: center;
			display: inline-block;
			font-size: 14px;
			position: relative;
			top: 0px;
			color: #ff6d22;
			margin-right: 4px;
		}
		.mui-numbox{
			border:none;
		}
		.mui-numbox [class*=btn-numbox], .mui-numbox [class*=numbox-btn]{
			background-color: #ff6d22;
			color: #fff;
		}
		.mui-numbox .mui-input-numbox, .mui-numbox .mui-numbox-input{
			background: #eeeeee;
			border:none!important
		}
		.footer_wrap {
		    width: 100%;
		    height: 50px;
		    background: linear-gradient(to left,#f08200,#f2800b,#ff7546);
		    text-align: center;
		    line-height: 50px;
		    position: fixed;
		    bottom: 0;
		    left: 0;
		    color: #fff;
		}
		#eles .setmeal_tap_header {
			padding: 15px 5px;
		}
		#ElesList{
			padding: 0;		
		}
		#fullStopList{
			padding: 0;
			margin-top: 10px;
		}
		#fullStopList .table_list span{
			font-size: 15px;
		}
		.yellow{
			color: #ff6d22;
			font-style: normal;
		}
		input.yellow-input{
			width: 30px;
		    padding: 2px 5px;
		    margin: 0;
		    height: 24px;
		    line-height: 20px;
		    text-align: center;
		}
		
    </style>
</head>
<body background="#f0f1f3">
		
<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title" id="stateName"></h1>
</header>

<div class="mui-content">
	<div class="setmeal_wrap" id="setmeals">
		<div class="setmeal_box">
			<div class="charges_tap flex">
				<div class="tap_list flex-item select">时间收费</div>
				<div class="tap_list flex-item">电量收费</div>
			</div>
			<!--时长区-->
			<div class="setmeal_content" id="charges">
				<h3 class="setmeal_title">时长区</h3>
				<div class="setmeal_tap_header">
					<span class="list-item left">价格<i>(元)</i></span>
					<span class="list-item right">时长<i>(小时)</i></span>
				</div>
				<div class="setmeal_tap_table">					
					<ul class="table_ul" id="chargesList">
						
					</ul>
				</div>
			</div>
			<!--阶梯价格-->
			<div class="setmeal_content"  id="eles">
				<h3 class="setmeal_title">阶梯价格</h3>
				<div class="setmeal_tap_header ">
					<div class="flex">
						<span class="flex-item first_span">功率</span>
						<span class="flex-item">最大成本</span>
						<span class="flex-item">价格</span>
					</div>
					<div class="flex">
						<span class="flex-item first_span"><i>(W)</i></span>
						<span class="flex-item"><i>(元/小时)</i></span>
						<span class="flex-item"><i>(元/小时)</i></span>
					</div>
				</div>
				<div class="setmeal_tap_table">
					<ul class="table_ul" id="ElesList">
						
					</ul>
				</div>
			</div>
			<!--充满自停-->
			<div class="setmeal_content" id="fullStop">
				<h3 class="setmeal_title">充满自停最大配置</h3>
				<div class="setmeal_tap_table">
					<ul class="table_ul" id="fullStopList">
						<li class="table_list flex">
							<span class="flex-item">最大电量<i class="yellow">5度</i></span>
							<span class="flex-item">最大时长<i class="yellow">5小时</i></span>
							<span class="flex-item">最多扣款<input type="tel" class="yellow-input" value="5">元</span>
						</li>
					</ul>
				</div>
			</div>
			<!--合伙人-->
			<div class="setmeal_content" id="partners">
				<h3 class="setmeal_title">合伙人分成设置</h3>
				<div class="setmeal_tap_header flex">
					<span class="flex-item first_span">姓名</span>
					<span class="flex-item">账号</span>
					<span class="flex-item">分成</span>
				</div>
				<div class="setmeal_tap_table">
					<ul class="table_ul" id="partnersList">
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<footer id="footer" style="height: 50px;">
	<div class="footer_wrap" id="submit">
		<span>提交</span>
	</div>
</footer>


<!--阶梯价格-->
<script type="text/html" id="elesTmpl" >
	{{each list as item index}}
		<li class="table_list flex">
			<span class="circle">{{index+1}}</span>
			{{if item.max>1200}}
				<span class="flex-item first_span">1200以上</span>
			{{else if item.min <=0}}
				<span class="flex-item first_span">100以下</span>
			{{else}}
			<span class="flex-item first_span">{{item.min}}-{{item.max}}</span>
			{{/if}}
			<span class="flex-item">{{item.cost}}</span>

			<div class="mui-numbox flex-item" data-numbox-step="10" data-numbox-min="0" data-numbox-max="100">
	            <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
	            <input class="mui-numbox-input" type="number" name="rate1" value="{{item.amount}}">
	            <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
	            <div class="clearfix"></div>
	        </div>
			
		</li>
	{{/each}}
</script>

<!--充满自停-->
<script type="text/html" id="fullStopTmpl" >
	<li class="table_list flex">
		<span class="flex-item">最大电量<i class="yellow">{{list.power}}度</i></span>
		<span class="flex-item">最大时长<i class="yellow">{{list.minutes}}小时</i></span>
		<span class="flex-item">最多扣款<input type="tel" class="yellow-input" value="{{list.amount}}">元</span>
	</li>
</script>

<!--时长区-->
<script type="text/html" id="chargesTmpl">
	{{each list as item index}}
	<li class="table_list">
		<div class="list-item left">
			<div class="mui-numbox" data-numbox-step="10" data-numbox-min="0" data-numbox-max="100">
	            <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
	            <input class="mui-numbox-input" type="number" name="rate1" value="3">
	            <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
	            <div class="clearfix"></div>
	        </div>
		</div>
		<div class="list-item right">
			<div class="mui-numbox" data-numbox-step="10" data-numbox-min="0" data-numbox-max="100">
	            <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
	            <input class="mui-numbox-input" type="number" name="rate1" value="2">
	            <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
	            <div class="clearfix"></div>
	        </div>
		</div>
	</li>
		<!--<span class="flex-item">{{item.amount}}</span>
		<span class="flex-item">{{item.minutes}}</span>-->
	{{/each}}
</script>

<!--合伙人-->
<script type="text/html" id="partnersTmpl">
	{{each list as item index}}
	<li class="table_list flex">
		<span class="flex-item first_span">{{item.name}}</span>
		<span class="flex-item">{{item.mobile}}</span>
		<span class="flex-item">{{item.divideRatio}}%</span>
	</li>
	{{/each}}
</script>

<script type="text/javascript">
	mui.init();
	
    var uuid = '615cd7b2d8f84377bd4d3bcd9bc9f731';
    var areaId = getQueryString('areaid');
  	var setmealName = plus.storage.getItem("setmealName");
  	
  	
    var ws=null;
    // 处理沉浸式状态栏
    var topoffset=0;
    var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
    if(ms&&ms.length>=3){
        topoffset=parseFloat(ms[2]);
    }
  
    if(window.plus){
        pagePlusReady();
    }else{
        document.addEventListener('plusready',pagePlusReady,false);
    }
	
    function pagePlusReady(){
        checkLogin();
		//uuid = plus.storage.getItem("uuid");		
        getDataList();
        
        ws=plus.webview.currentWebview();
        if(plus.navigator.isImmersedStatusbar()){// 兼容沉浸式状态栏模式
            topoffset=Math.round(plus.navigator.getStatusbarHeight());
        }
        ws.setPullToRefresh({support:true,style:'circle',offset:topoffset+45+'px'},onRefresh);

    }
    // 刷新页面
    function onRefresh(){
        getDataList();
        ws.endPullToRefresh();
    }
    
    function getDataList(){
    	var params = {
			'areaId':areaId	
		}
		postJSON(API_URL.ApiGetApplyChargingGroupById,params,function(res){
			if(res.code == '0'){
				var priceSetmealJson = res.data.priceSetmealJson;
				if(vaildeParam(priceSetmealJson)){
					plus.storage.setItem( "priceSetmealJson", priceSetmealJson);
					var priceSetmealJSON = JSON.parse(priceSetmealJson);				
					var priceSetmealData = {};

			  		$.each(priceSetmealJSON, function(index,item) {
						if(item.name == setmealName){
							priceSetmealData = item;
						}
					});	
			  		getAllData(priceSetmealData);
				}else{
					clicked('areaApplicationDetail.html');
				}
			}else{
				layer.msg(res.msg);
			}
		});	
    }
	function getAllData(priceSetmealData){
		var eles = priceSetmealData.eles;				
		var fullStop = priceSetmealData.fullStop;
		var actualCharges = priceSetmealData.actualCharges;
		var advanceCharges = priceSetmealData.advanceCharges;
		var partners = priceSetmealData.partners;
		var state = priceSetmealData.state;
		$('#stateName').html(state);
  		if(vaildeParam(eles)){
			getElesData(eles);
  		}
  		if(vaildeParam(fullStop)){
			getFullStopData(fullStop);
  		}
  		if(vaildeParam(actualCharges)||vaildeParam(advanceCharges)){
  			if(vaildeParam(actualCharges)){
  				var Charges = actualCharges;
  			}else if(vaildeParam(advanceCharges)){
  				var Charges = advanceCharges;
  			}
			getChargesData(Charges);
  		}
  		if(vaildeParam(partners)){
			getPartnersData(partners);
  		}
	}
	//获取阶梯价格数据
    function getElesData(eles){
  		var data = {'list':eles};
  		var elesHtml = template('elesTmpl', data);
  		$('#ElesList').html(elesHtml);
  	}
    //获取充满自停数据
    function getFullStopData(fullStop){
  		var data = {'list':fullStop};
  		var fullStopHtml = template('fullStopTmpl', data);
  		$('#fullStopList').html(fullStopHtml);	
  	}
    //获取时长区数据
    function getChargesData(charges){
  		var data = {'list':charges};
  		var ChargesHtml = template('chargesTmpl', data);
  		$('#chargesList').html(ChargesHtml);
  		mui('.mui-numbox').numbox();
  	}
  	//获取合伙人数据
  	function getPartnersData(partners){
		var data = {'list':partners};
		var partnersHtml = template('partnersTmpl', data);
		$('#partnersList').html(partnersHtml);
  	}
	
	
</script>

</body>
</html>
