<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>我的充电桩</title>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="../plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/hammer.min.js"></script>
    <script src="../js/jquery.hammer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/mui.min.js"></script>
    <style type="text/css">
        .topInfoBox{
            text-align: center;
            padding-top: 10px;
        }
        .topInfoBox h1{
            color: #F17E38;
            font-size: 4rem;
            font-weight: 400;
        }
        .topInfoBox small{
            font-size: .8rem;
            color: #9D9D9D;
        }

        .tabBox{
            text-align: center;
            padding-top: 20px;
        }
        .tabBox span{
            display: inline-block;
            padding: 5px 10px;
            font-size: .8rem;
        }
        .tabBox span.select{
            border-bottom: #EC8131 solid 2px;
        }
        .midRow{
            background: #F0F1F3;
            padding: 10px 5px;
            font-size: .8rem;
            color: #979797;
        }

        .mui-table-view{
            font-size: .9rem;
        }
        .mui-table-view .mui-badge{
            background: transparent;
            font-size: .9rem;
        }

        #loadMore{
            background: #eaeaea;
            margin-top: 10px;
            padding: 10px;
            text-align: center;
            margin-top: 10px;
            font-size: .8rem;
            display: none;
        }
        .noMore{
            margin-top: 10px;
            padding: 10px;
            text-align: center;
            margin-top: 10px;
            font-size: .8rem;
            display: none;
        }

    </style>

</head>
<body style="background: #fff">

<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">我的充电桩</h1>
</header>

<div class="mui-content" style="background: #fff">

    <div class="topInfoBox">
        <h1>324</h1>
        <small>我的充电桩总数(台)</small>
    </div>

    <div class="tabBox">
        <span id="normal" class="tabItem select">正常充电桩(<span>320</span>)</span>
        <span id="abnormal"  class="tabItem ">异常充电桩(<span>4</span>)</span>
    </div>

    <div class="midRow">
        <div class="left">片区(<span>4</span>)</div>
        <div class="right">月收入(<span>元</span>)</div>
        <div class="clearfix"></div>
    </div>
    <div  class="normal" style="display: block" >
        <ul class="mui-table-view dataList">


        </ul>
        <div id="loadMore" class="loadMore">加载更多</div>
        <div id="noMore" class="noMore">没有更多了</div>
    </div>

    <div  class="abnormal" style="display: none" >
        <ul class="mui-table-view dataList1">

        </ul>
        <div id="loadMore1" class="loadMore">加载更多</div>
        <div id="noMore1" class="noMore">没有更多了</div>
    </div>

</div>


<script type="text/html" id="dataTmpl">
    <li class="mui-table-view-cell">
        <a class="mui-navigate-right" onclick="clicked('areaList.html')">
            <span class="mui-badge">{{money}}</span>
            片区名称:{{groupName}}
        </a>
    </li>
</script>


<script type="text/javascript">
    mui.init();

    var btnType ="0";  //正常：0 异常：1
    var pageNumber = 1;
    var pageNumber1 = 1;
    var pageSize = 10;

    if(window.plus){
        pagePlusReady();
    }else{
        document.addEventListener('plusready',pagePlusReady,false);
    }
    function pagePlusReady(){
        getList();
    }



    //点击正常充电桩
    $("#normal").click(function(){
        $(this).addClass("select");
        $("#abnormal").removeClass("select");
        $(".abnormal").css("display","none");
        $(".normal").css("display","block");

        pageNumber = 1;
        btnType = "0";
       $(".dataList").html("");

        getList();
    });

    //点击异常充电桩
    $("#abnormal").click(function(){
        $(this).addClass("select");
        $("#normal").removeClass("select");
        $(".abnormal").css("display","block");
        $(".normal").css("display","none");

        pageNumber1 = 1;
        btnType = "1";
        $(".dataList1").html("");

       getList();
    });


    /**
     抓取数据
     */
    function getList(){
        var uuid = plus.storage.getItem("uuid");
        if(vaildeParam(uuid)){
            var nember = 1 ;
            if("0"==btnType){
                nember = pageNumber;
            }else{
                nember = pageNumber1;
            }
            var dataParam= {
                "uuid":uuid,
                "recordType":"0",
                "consumptionType":consumptionType,
                "pageSize":pageSize,
                "pageNumber":nember
            }
            postJSON(API_URL.ApiDetailRecordGetDetailRecordList,dataParam,function(res){
                if("0" == res.code){


                    var data = res.data.pagedata.content;

                    var html = '';
                    $.each(data, function(index,item) {
                        var  tmpl = $("#dataTmpl2").html();
                        var createDate = new Date(item.createDate).format("yyyy-MM-dd hh:mm:ss");
                        var  title = item.title;
                        var amount = item.amount;
                        html += tmpl.replace(/{{createDate}}/g,createDate)
                            .replace(/{{amount}}/g,item.amount)
                            .replace(/{{title}}/g,title);
                    });
                    if(1 == pageSize){
                        if("1"==consumptionType){
                            $(".dataList").html("");
                        }else{
                            $(".dataList1").html("");
                        }
                    }
                    if("1"==consumptionType){
                        $(".dataList").append(html);
                    }else{
                        $(".dataList1").append(html);
                    }

                    if(true == res.data.pagedata.last){
                        if("1"==consumptionType){
                            $("#loadMore").css({"display":"none"});
                            $("#noMore").css({"display":"block"});
                        }else{
                            $("#loadMore1").css({"display":"none"});
                            $("#noMore1").css({"display":"block"});
                        }
                    }else{
                        if("1"==consumptionType){
                            $("#loadMore").css({"display":"block"});
                            $("#noMore").css({"display":"none"});
                        }else{
                            $("#loadMore1").css({"display":"block"})
                            $("#noMore1").css({"display":"none"});
                        }
                    }

                }else{
                    layer.msg(res.msg);
                }
            })
        }
    }


    $(".loadMore").click(function(){
        if("1"==consumptionType){
            pageNumber++;
        }else{
            pageNumber1++;
        }
        getList();
    })









</script>
</body>

</html>