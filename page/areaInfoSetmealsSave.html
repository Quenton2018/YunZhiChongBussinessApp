<!DOCTYPE html>
<html>
	<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>片区新申请添加</title>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="../plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/hammer.min.js"></script>
    <script src="../js/jquery.hammer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/mui.min.js"></script>
    <script src="../js/vue.min.js"></script>
    <style type="text/css">
    	input{  		
		    -webkit-user-select: auto!important;  
		}  	
    	.setmeal_wrap{
    		/*display: none;*/
    	}
		.setmeal_box{
			padding: 10px;
		}
		.charges_tap{
			margin: 0 30px 10px;
			border: 1px solid #ff6d22;
			border-radius: 6px;
		}
		.tap_list{
			width: 50%;
		    padding: 10px 0;
		    text-align: center;
		    font-size: 0.9rem;
		}
		.tap_list.select{
			background: #ff6d22;
			color: #FFF;
		}
		.setmeal_content{
			padding: 15px 10px;
			background: #fff;
			border-radius: 6px;
			margin-bottom: 10px;
		}
		.setmeal_title{
			color: #4d4d4d;
			font-size: 16px;
			font-weight: 400;
			margin-bottom: 15px;
		}
		.setmeal_title:before{
			border-left: 5px solid #ff6d22;
			border-radius: 2px;
			content: '';
			margin-right: 6px;
		}
    	.setmeal_tap_header{
    		overflow: hidden;	
    	}
    	.setmeal_tap_header span{  		
    		text-align: center;
    		font-size: 0.9rem;
    		width: 36%;
    		display: inline-block;
    	}
    	.setmeal_tap_header span i{
    		font-size: 0.8rem;
    		color: #acacac;
    		font-style: normal;
    	}
    	.table_ul{
    		padding: 0;
    		margin: 0;
    	}
    	.table_list{
    		padding: 12px 0;
    		border-bottom: 1px dashed #808080;
    		list-style: none;
    		overflow: hidden;
    		position: relative;
    	}
    	.table_list:last-child{
    		border-bottom: none;
    	}
    	.table_list span{
    		text-align: center;
    		font-size: 1rem;
    	}
		.table_list span.first_span{
    		text-align: left;
    		padding-left: 10px;
    	}

    	.table_list span .circle {
			width: 16px;
			height: 16px;
			line-height: 14px;
			border-radius: 50%;
			box-sizing: border-box;
			border: 1px solid #ff6d22;
			text-align: center;
			display: inline-block;
			font-size: 14px;
			color: #ff6d22;
			margin-right: 4px;
			vertical-align: 1px;
			font-style: normal;
		}
		.list-item{
			margin-left: 24px;
			width: 36%;
		}
		.list-del span{
			position: absolute;
			right: 8px;
			top: 16px;
			font-size: 28px;
		}

		.mui-numbox [class*=btn-numbox], .mui-numbox [class*=numbox-btn]{
			background-color: #ff6d22;
			color: #fff;
		}
		.mui-numbox .mui-input-numbox, .mui-numbox .mui-numbox-input{
			background: #eeeeee;
			border:none!important
		}
		.yellow{
			color: #ff6d22;
			font-style: normal;
		}
		input.yellow-input{
			width: 32px;
		    padding: 2px 6px;
		    margin: 0 2px;
		    height: 24px;
		    line-height: 20px;
		    text-align: center;	    
		}
		.addCharges{
			float: right;
			font-size: 0.8rem;
			padding: 0 6px;
		}
		.addCharges .mui-icon{
			font-size: 18px;
			padding-right: 4px;
			color: #ff6d22;
			font-weight: bold;
		}
		.mui-numboxs {
		    position: relative;
		    display: inline-block;
		    overflow: hidden;
		    width: 100%;
		    height: 35px;
		    /*padding: 0 30px;*/
		    vertical-align: top;
		    vertical-align: middle;
		    border: solid 1px #bbb;
		    border-radius: 3px;
		    background-color: #efeff4;
		}
		.mui-numboxs [class*=btn-numbox], .mui-numboxs [class*=numbox-btn] {
		    font-size: 18px;
		    font-weight: 400;
		    line-height: 100%;
		    position: absolute;
		    top: 0;
		    overflow: hidden;
		    width: 28%;
		    height: 100%;
		    padding: 0;
		    color: #555;
		    border: none;
		    border-radius: 0;
		    background-color: #f9f9f9;
		    background-color: #ff6d22;
    		color: #fff;
		}
		.mui-numboxs .mui-numbox-btn-minuss{
			left: 0;
    		border-top-left-radius: 3px;
    		border-bottom-left-radius: 3px;
		}
		.mui-numboxs .mui-numbox-btn-pluss{
		    right: 0;
		    border-top-right-radius: 3px;
		    border-bottom-right-radius: 3px;
		}
		.mui-numboxs{
			border:none;
		}

		.mui-numboxs .mui-input-numbox, .mui-numboxs .mui-numbox-input {
		    display: inline-block;
		    overflow: hidden;
		    width: 100%!important;
		    height: 100%;
		    margin: 0;
		    padding: 0 3px!important;
		    text-align: center;
		    text-overflow: ellipsis;
		    word-break: normal;
		    border: none!important;
			background: #eeeeee;
		    border-radius: 0!important;
		    font-size: 1rem;
		}
		.fullstop-item{
			float: left;
			text-align: center;
			font-size: 1rem;
		}
		.table_list .fullstop-item{
			line-height: 40px;
		}
		.fullstop-item input{
			padding: 0 10px;
    		margin: 0;
    		text-align: center;
    		color: #969696;
    		background: #eeeeee;
		}

		#partners .partners-item{
			width: 25%;
			float: left;
			text-align: center;
			display: inline-block;
			font-size: 0.9rem;
			padding: 3px 5px;
			margin-right: 1%;
			margin-bottom: 0;	
		}
		#partners input.partners-item{
			color: #969696;
			background: #eeeeee;
		}
		#partners input[readonly] {
		    background: #fff;
		    border: none;
		    color: #4d4d4d;
		}
		#partners .list-del span{
			right: 0px;
			top: 18px;
		}
		/*弹窗*/

		.mui-mask{
        	width: 100%;
        	height: 100%;
        	background-color: rgba(0,0,0,0.7);
        	position: fixed;
        	top: 0;
        	left: 0;
        	right: 0;
        	bottom: 0;
        	margin: auto;
        	z-index: 98;
        }
        .set_complete_wrap,.continue_top_wrap {
        	width: 60%;
        	height: 250px;
        	background-color: #fff;
        	position: fixed;
        	top: 0;
        	left: 0;
        	right: 0;
        	bottom: 0;
        	margin: auto;
        	border-radius: 6px;
        	z-index: 100;
        }
        .set_top {
        	height: 130px;
        	position: relative;
        }
        .set_bottom {
        	height: 120px;
        	background-color: #ff6d22;
        	border-bottom-left-radius: 6px;
        	border-bottom-right-radius: 6px;
        	position: relative;
        	overflow: hidden;
        }
        .set_top .gou_photo {
        	width: 80px;
        	height: 80px;
        	position: absolute;
        	top: 0;
        	left: 0;
        	right: 0;
        	bottom: 0;
        	margin: auto;
        }
        .set_top .close {
        	width: 14px;
        	height: 14px;
        	position: absolute;
        	top: 10px;
        	right: 10px;
        }
        .set_bottom p {
        	height: 15px;
        	line-height: 15px;
        	text-align: center;
        	color: #fff;
        	font-size: 0.8rem;
        }
        .set_bottom p:first-child {
        	margin-top: 25px;
        }
        .set_bottom p:last-child {
        	margin-top: 8px;
        }
        .set_btn {
        	width: 80%;
        	margin: 0 auto;
        	overflow: hidden;
        }
        .set_btn button {
        	padding: 4px 6px;
        	border: 1px solid #fff;
        	border-radius: 4px;
        	background-color: #fff;
        	font-size: 0.8rem;
        }
        .set_btn button:first-child {
        	float: left;
        	background-color: transparent;
        	color: #fff;
        }
        .set_btn button:last-child {
 			float: right;
        	color: #ff6d22;
        }
    </style>
</head>
<body background="#f0f1f3" >

<div id="app">
	
<header class="header header-immersed mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title" id="stateName">{{stateName}}</h1>
</header>

<footer class="mui-bar mui-bar-footer btn-submit" v-on:click="submits">
	<span>提交</span>
</footer>
	
<div class="mui-content" >
	<div class="setmeal_wrap" id="setmeals">
		<div class="setmeal_box">
			<!--时长区-->
			<div id="charges">
				<div class="charges_tap flex">
					<div class="tap_list flex-item" v-bind:class="isTime ? 'select':''" @click="tapClick('timesf')">时间收费</div>
					<div class="tap_list flex-item" v-bind:class="!isTime ? 'select':''" @click="tapClick('dlsf')">电量收费</div>
				</div>
				<div class="setmeal_content">
					<h3 class="setmeal_title">时长区<span class="addCharges" v-on:click="addCharges"><i class="mui-icon mui-icon-plus"></i>新增</span></h3>
					<div class="setmeal_tap_header">
						<span class="list-item left">价格<i>(元)</i></span>
						<span class="list-item left">时长<i>(分钟)</i></span>
					</div>
					<div class="setmeal_tap_table">					
						<ul class="table_ul" id="chargesList">
							<li class="table_list" v-for="(item, index) in chargesList">
								<div class="list-item left">
									<div class="mui-numboxs">
							            <button class="mui-btn mui-numbox-btn-minuss" type="button" @click="btnMinus(chargesList,'amount',index)">-</button>
							            <input class="mui-numbox-input" type="number" name="price" v-model="item.amount" readonly="true">
							            <button class="mui-btn mui-numbox-btn-pluss" type="button" @click="btnPlus(chargesList,'amount',index)">+</button>
							            <div class="clearfix"></div>
							        </div>
								</div>
								<div class="list-item left">
									<div class="mui-numboxs">
							            <button class="mui-btn mui-numbox-btn-minuss" type="button" @click="btnMinus(chargesList,'minutes',index)">-</button>
							            <input class="mui-numbox-input" type="number" name="time" v-model="item.minutes" readonly="true">
							            <button class="mui-btn mui-numbox-btn-pluss" type="button" @click="btnPlus(chargesList,'minutes',index)">+</button>
							            <div class="clearfix"></div>
							        </div>
								</div>
								<div class="list-del left" v-if="index!==0" @click="delCharges(index)">
									<span class="mui-icon mui-icon-trash"></span>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!--阶梯价格-->
			<div class="setmeal_content" id="eles" style="display: none;">
				<h3 class="setmeal_title">阶梯价格</h3>
				<div class="setmeal_tap_header">
					<div class="flex">
						<span class="eles-item" style="width: 30%;">功率</span>
						<span class="eles-item" style="width: 30%;">最大成本</span>
						<span class="eles-item" style="width: 40%;">价格</span>
					</div>
					<div class="flex">
						<span class="eles-item" style="width: 30%;"><i>(W)</i></span>
						<span class="eles-item" style="width: 30%;"><i>(元/小时)</i></span>
						<span class="eles-item" style="width: 40%;"><i>(元/小时)</i></span>
					</div>
				</div>
				<div class="setmeal_tap_table">
					<ul class="table_ul" id="ElesList">
						<li class="table_list flex" v-for="(item, index) in elesList">
							<span class="eles-item" style="width: 30%;" v-if="item.max>1200"><i class="circle">{{index+1}}</i>1200以上</span>

							<span class="eles-item" style="width: 30%;" v-else-if="item.min <=0"><i class="circle">{{index+1}}</i>100以下</span>

							<span class="eles-item" v-else style="width: 30%;"><i class="circle">{{index+1}}</i>{{item.min}}-{{item.max}}</span>

							<span class="eles-item" style="width: 30%;">{{item.cost}}</span>
							
							<div class="mui-numboxs eles-item" style="width: 40%;">
					            <button class="mui-btn mui-numbox-btn-minuss" type="button" @click="btnMinus(elesList,'amount',index)">-</button>
					            <input class="mui-numbox-input" type="number" name="time" v-model="item.amount">
					            <button class="mui-btn mui-numbox-btn-pluss" type="button" @click="btnPlus(elesList,'amount',index)">+</button>
					            <div class="clearfix"></div>
					        </div>
						</li>
					</ul>
				</div>
			</div>
			<!--充满自停-->
			<div class="setmeal_content" id="fullStop">
				<h3 class="setmeal_title">充满自停最大配置</h3>
				<div class="setmeal_tap_header">
					<span class="fullstop-item" style="width: 30%;">电量<i>(度)</i></span>
					<span class="fullstop-item" style="width: 30%;">时长<i>(分钟)</i></span>
					<span class="fullstop-item" style="width: 40%;">最多扣款<i>(元)</i></span>
				</div>
				<div class="setmeal_tap_table">
					<div class="table_list mui-clearfix" id="fullStopList">
						<span class="fullstop-item" style="width: 30%;"><i class="yellow">{{fullStopList.power}}</i></span>
						<span class="fullstop-item" style="width: 30%;"><i class="yellow">{{fullStopList.minutes/60}}</i></span>
						<span class="fullstop-item" style="width: 40%;">
							<input type="number" style="width: 50%;" v-model="fullStopList.amount" maxlength="10"/>
						</span>
					</div>
				</div>
			</div>
			<!--合伙人-->
			<div class="setmeal_content" id="partners">
				<h3 class="setmeal_title">合伙人分成设置<span class="addCharges" v-on:click="addPartners"><i class="mui-icon mui-icon-plus"></i>新增</span></h3>
				<div class="setmeal_tap_header">
					<span class="partners-item" style="width: 22%;">姓名</span>
					<span class="partners-item" style="width: 30%;">账号</span>
					<span class="partners-item" style="width: 18%;">金额<i>(元)</i></span>
					<span class="partners-item" style="width: 18%;">比值<i>(%)</i></span>
				</div>
				<div class="setmeal_tap_table">
					<ul class="table_ul" id="partnersList">
						<li class="table_list" v-for="(item, index) in partnersList">
							<input type="text" style="width: 22%;" class="partners-item" v-model="item.name" :readonly="(index!==0 && index!==1)? false : 'readonly'" />
							<input type="tel" style="width: 30%;" class="partners-item"  v-model="item.mobile" maxlength="11" :readonly="(index!==0)? false : 'readonly'" />
							<input type="number" style="width: 18%;" class="partners-item" v-model="item.dividePrice" maxlength="11"/>
							<input type="number" style="width: 18%;" class="partners-item" v-model="item.divideRatio" maxlength="3"/>
							<div class="list-del"  v-if="index!==0 && index!==1" @click="delPartners(index)">
								<span class="mui-icon mui-icon-trash"></span>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

	<!--遮挡层弹窗-->
	<div class="mui-mask" style="display: none;" id="setMask">
		<div class="set_complete_wrap">
			<div class="set_top">
				<img class="gou_photo" src="../images/area/gou.png" alt="勾" />
				<img class="close" @click="closeMask" src="../images/pianqushenqing/guanbi@3x.png" alt="关闭" />
			</div>
			<div class="set_bottom">
				<div class="continue">
					<p>您的<span>基本套餐</span>设置完成, 是</p>
					<p>否需要添加其他套餐</p>
					<div class="set_btn">
						<button id="thanks" @click="closeMask">不用,谢谢</button>
						<button id="href" @click="otherAdd">添加其他套餐</button>
					</div>
				</div>
			</div>
			<!---->
		</div>
	</div>


</div>

<script type="text/javascript">
	mui.init();
	
	var uuid = '';
    var setmealName = '';
    var applyGroup = {};
	var jsonSetmealJsonStr = [];
	var vm = null;
  	$.plusReady(function() {
     	checkLogin();
		uuid = plus.storage.getItem("uuid");
		setmealName = plus.storage.getItem("setmealName");
		applyGroup = JSON.parse(plus.storage.getItem('applyGroup'));
		jsonSetmealJsonStr = JSON.parse(plus.storage.getItem("jsonSetmealJsonStr")) || [];  //套餐数组
//		console.log(jsonSetmealJsonStr.length);
        getDataList();
		setVueData();
    },function(){
    	getDataList();
    	setVueData();
    });
	
    function getDataList(){
    	var params = {
    		'uuid':uuid,
    		'state':applyGroup.state,
			'price':applyGroup.price	
		}
		postJSON(API_URL.ApiChargingBusinessGetSetmealPrice,params,function(res){
			if(res.code == '0'){			
				var priceSetmealData = res.data;
				priceSetmealData.name = applyGroup.applySetmealName || '基本套餐';
			  	getAllData(priceSetmealData);
			}else{
				layer.msg(res.msg);
			}
		});
    }
	function getAllData(priceSetmealData){
		var eles = priceSetmealData.eles;				
		var fullStop = priceSetmealData.fullStop;
		var actualCharges = priceSetmealData.actualCharges;
		var advanceCharges = priceSetmealData.advanceCharges;
		var partners = priceSetmealData.partners;

		plus.storage.setItem("priceSetmealData", JSON.stringify(priceSetmealData));
  		if(vaildeParam(eles)){
			vm.elesList = eles;
  		}
  		if(vaildeParam(fullStop)){
			vm.fullStopList = fullStop;
  		}
  		if(vaildeParam(actualCharges)||vaildeParam(advanceCharges)){
  			if(vaildeParam(actualCharges)){
  				var Charges = actualCharges;
  			}else if(vaildeParam(advanceCharges)){
  				var Charges = advanceCharges;
  			}
			vm.chargesList = Charges;
  		}
  		if(vaildeParam(partners)){
  			vm.partnersList = partners;
  		}
	}

	function SaveChargingGroup(jsonSetmealJSON){
		var applyGroup = JSON.parse(plus.storage.getItem('applyGroup'));
		console.log("####申请页电价price####"+applyGroup.price);
		var params = {
			uuid:uuid,
			app_name:applyGroup.name,
			app_electricPrice:applyGroup.price,
			memberListJson:'[]',
			dianjiaListJson:'[]',
			priceSetmealJson:JSON.stringify(jsonSetmealJSON)
		};
		postJSON(API_URL.ApiApplyChargingGroupSaveChargingGroup,params,function(res){
			if(res.code == '0'){
	            var ws = plus.webview.currentWebview();
	            var wo = ws.opener();
	            do {
	            	if (wo.getURL().endsWith("areaApplicationList.html")) {
	            		break;
	            	}
	            	
	            	var temp = wo.opener();
	            	wo.close("none");
	            	wo = temp;
	            } while (true);
		
				setTimeout(function() {
					wo.evalJS("dataRefresh()");
					ws.close();
				}, 300);
		
				/*var ws = plus.webview.currentWebview();
				var wo = ws.opener();
				var wlist = wo.opener();
				wo.close("none");
				setTimeout(function() {
					wlist.evalJS("dataRefresh()");
					ws.close();
				}, 300);*/
//				clicked('areaApplicationList.html');
			}else{
				layer.msg(res.msg);
			}
		})
	}
	
	
  
	function setVueData() {
		vm = new Vue({
			el:'#app',
			data:{
				state:'',
				stateName:'',
				chargesList:[{
			        "state": "-1",
			        "minutes": 240,
			        "power": 1,
			        "amount": 0.96
			    },{
			        "state": "-1",
			        "minutes": 360,
			        "power": 1.5,
			        "amount": 1.45
			    },{
			        "state": "-1",
			        "minutes": 480,
			        "power": 2,
			        "amount": 1.92
			    },{
			        "state": "-1",
			        "minutes": 600,
			        "power": 2.5,
			        "amount": 2.4
			    }],
				elesList:[{
			        "seq": 0,
			        "min": 0,
			        "max": 100,
			        "cost": 0.08,
			        "amount": 0.1
			    },{
			        "seq": 1,
			        "min": 100,
			        "max": 300,
			        "cost": 0.24,
			        "amount": 0.29
			    },{
			        "seq": 2,
			        "min": 300,
			        "max": 600,
			        "cost": 0.48,
			        "amount": 0.58
			    },{
			        "seq": 3,
			        "min": 600,
			        "max": 900,
			        "cost": 0.72,
			        "amount": 0.87
			    },{
			        "seq": 4,
			        "min": 900,
			        "max": 1200,
			        "cost": 0.96,
			        "amount": 1.16
			    },{
			        "seq": 5,
			        "min": 1200,
			        "max": 1500,
			        "cost": 1.2,
			        "amount": 1.44
			    }],
				fullStopList:{
			      "state": "1",
			      "minutes": 600,
			      "power": 5,
			      "amount": 4.8
			    },
				partnersList:[],
				isTime:true
			},
			created:function(){
				var state = applyGroup.state;
				this.state = state;
				if (state == '1') {
					this.stateName = '充满自停';
					$("#charges").hide();
					$("#eles").show();
				}
				if (state == '2') {
					this.stateName = '充电时长';
					this.state = '-1';
					$("#fullStop").hide();
				}
				if (state == '3') {
					this.stateName = '充满自停+充电时长';
					this.state = '1:-1';
					$("#eles").show();
				}
			},
			methods:{
				addCharges:function(){
					vm.chargesList.push({
						amount:0.96,
						minutes:240,
						power:1,
						state:''
					});
				},
				delCharges:function(index){
					vm.chargesList.splice(index, 1);
				},
				addPartners:function(){
					vm.partnersList.push({
						name:'',
						mobile:'',
						dividePrice:'',
						divideRatio:''
					});
				},
				delPartners:function(index){
					vm.partnersList.splice(index, 1);
				},
				btnMinus:function(List,name,index){
					var num = 30;
					var prices = parseFloat(List[index][name]);
					if(isNaN(prices)){
						layer.msg('请输入正确的数字');
						return;
					}
					if(name == 'amount'){
						num = 0.5;
						if (prices < 1){
		                    prices = 0;
		                }else{
		                    List[index][name] = (prices - num).toFixed(2);
		                }
					}else{
						if (prices < 1){
		                    prices = 0;
		                }else{
							prices = parseInt(List[index][name]);
							List[index][name] = (prices - num);
						}
					}				
				},
				btnPlus:function(List,name,index){
					var num = 30;
					var prices = parseFloat(List[index][name]);
	
					if(isNaN(prices)){
						layer.msg('请输入正确的数字');
						return;
					}
					if(name == 'amount'){
						num = 0.5;
						List[index][name] = (prices + num).toFixed(2);
					}else{
						prices = parseInt(List[index][name]);
						List[index][name] = (prices + num);
					}            	
				},
				tapClick:function(type){
					if(type == 'timesf'){
						vm.isTime = true;
						if(this.stateName == '充电时长'){
							this.state = '-1';
							$("#eles").hide();
						}else if(this.stateName == '充满自停+充电时长'){
							this.state = '1:-1';
							$("#eles").show();
						}
					}else if(type == 'dlsf'){
						vm.isTime = false;
						if(this.stateName == '充电时长'){
							this.state = '2';
							$("#eles").show();
						}else if(this.stateName == '充满自停+充电时长'){
							this.state = '1:2';
							$("#eles").show();
						}
					}
				},
				closeMask:function(){
					$('.mui-mask').hide();
					var jsonSetmealJSON = JSON.parse(plus.storage.getItem("jsonSetmealJSON"));
					jsonSetmealJsonStr.push(jsonSetmealJSON);
					plus.storage.setItem("jsonSetmealJsonStr",JSON.stringify(jsonSetmealJsonStr));
					SaveChargingGroup(jsonSetmealJsonStr);
				},
				otherAdd:function(){
					$('.mui-mask').hide();
					var jsonSetmealJSON = JSON.parse(plus.storage.getItem("jsonSetmealJSON"));
						jsonSetmealJsonStr.push(jsonSetmealJSON);
						plus.storage.setItem("jsonSetmealJsonStr",JSON.stringify(jsonSetmealJsonStr));
					var setmealData = [];
					$.each(jsonSetmealJsonStr, function(index,item) {
						setmealData.push({
							'value':'',
							'state':item.state,
							'text':item.name
						});
					});
					var updateGroup = {
						'areaName': applyGroup.name,
						'price':'0.8',
						'state':this.state,
						'setmealName':applyGroup.applySetmealName,
						'setmealData':setmealData,
						'areaType':'otheradd'
					}
					plus.storage.setItem('updateGroup', JSON.stringify(updateGroup));
					clicked('areaApplicationSetmeals.html?areaid=other');
				},
				submits:function(){
					var jsonSetmealJSON = JSON.parse(plus.storage.getItem("priceSetmealData"));
					var reg = /^-?[1-9]+(\.\d+)?$|^-?0(\.\d+)?$|^-?[1-9]+[0-9]*(\.\d+)?$/;
					var rateSum = 0;
					var flag = false;
					var flagNumber = false;
					var amountFullStop = vm.fullStopList.amount;
					if(!vaildeParam(amountFullStop)){
						layer.msg("请正确输入充满自停配置信息");
						return false;
					}
					//校验是数字
	                if(!reg.test(amountFullStop)){  
	                    layer.msg("充满自停最多扣款配置必须为数字");
	                    return false;
	                }
					$.each(vm.partnersList,function(index,item){				
						var name = item.name;
						var mobile = item.mobile;
						var dividePrice = item.dividePrice;
						var divideRatio = item.divideRatio;
						rateSum += parseInt(divideRatio);
						
						if(!vaildeParam(name) || !vaildeParam(mobile) || !vaildeParam(divideRatio)){
		                    flag = true;
		                    return;
		                }
						
						//校验是数字
		                if(!reg.test(divideRatio)){
		                    flagNumber = true;
		                    return;
		                }
					})
					
					if(flag){
		                layer.msg("请补全合伙人信息");
		                return;
		            }
					if(flagNumber){
		                layer.msg("合伙人金额与比值必须为数字");
		                return;
		            }
					if(rateSum!=100){
		                layer.msg("合伙人比值为整数且相加必须为100%");
		                return;
		            }
					jsonSetmealJSON.eles = vm.elesList;
					jsonSetmealJSON.fullStop = vm.fullStopList;
					jsonSetmealJSON.partners = vm.partnersList;
					
					jsonSetmealJSON.state = vm.state;
					
					if(jsonSetmealJSON.state == '1'){       //充满自停
						jsonSetmealJSON.advanceCharges = null;
						jsonSetmealJSON.actualCharges = null;
					}else if(jsonSetmealJSON.state == '-1'){	//充电时长(时间收费)			
						jsonSetmealJSON.fullStop = null;
						jsonSetmealJSON.advanceCharges = vm.chargesList;
						jsonSetmealJSON.actualCharges = null;
						jsonSetmealJSON.eles = null;
					}else if(jsonSetmealJSON.state ==  '2'){   //充电时长(电量收费)			
						jsonSetmealJSON.fullStop = null;
						jsonSetmealJSON.advanceCharges = null;
						jsonSetmealJSON.actualCharges = vm.chargesList;
					}else if(jsonSetmealJSON.state == '1:-1'){   //充满自停+充电时长(时间收费)
						jsonSetmealJSON.advanceCharges = vm.chargesList;
						jsonSetmealJSON.actualCharges = null;			    					
					}else if(jsonSetmealJSON.state == '1:2'){ 
						jsonSetmealJSON.advanceCharges = null;
						jsonSetmealJSON.actualCharges = vm.chargesList;
					}else{
						layer.msg("套餐类型不正确");
						return;
					}
					//套餐检验
					var params = {
						uuid:uuid,
						jsonSetmeal:JSON.stringify(jsonSetmealJSON)
					}
	//				console.log(JSON.stringify(jsonSetmealJSON))
					postJSON(API_URL.ApiChargingBusinessGetcheckJsonSetmeal,params,function(res){
						if(res.code == '0'){
							plus.storage.setItem("jsonSetmealJSON",JSON.stringify(jsonSetmealJSON));
							$("#setMask").show();
							//SaveChargingGroup(jsonSetmealJSON);					
						}else{
							layer.msg(res.msg);
						}
					})
				}
			}
		});
	}

</script>

</body>
</html>
