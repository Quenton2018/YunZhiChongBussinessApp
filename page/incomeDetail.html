<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>收入明细</title>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="../plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="../css/mui.picker.min.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/hammer.min.js"></script>
    <script src="../js/jquery.hammer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/mui.min.js"></script>
    <style type="text/css">

        .topBox{
            position: relative;
        }

        .dataList{
            font-size: .9rem;
        }
        .dataList .mui-badge{
            background: transparent;
            font-size: .9rem;
            color: #333;
            font-weight: 300;
        }
        .dataList .mui-badge b{
            font-weight: 300;
        }

        .topBox .row1{
            padding: 10px;
            color: #6F6F70;
            font-size: .9rem;
            padding-bottom: 0px;
        }
        .topBox .row2{
            font-size: .7rem;
            padding: 0 10px;
            color: #A9A9AA;
            padding-bottom: 5px;
        }

        #loadMore{
            background: #eaeaea;
            padding: 10px;
            text-align: center;
            font-size: .8rem;
            display: none;
        }
        .noMore{
            padding: 10px;
            text-align: center;
            font-size: .8rem;
            display: none;
        }

    </style>

</head>
<body>

<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">收入明细</h1>
</header>

<div class="mui-content">

    <div class="topBox">
        <div class="row1 selectDate"><span></span> <i class="iconfont icon-xiala1"></i> </div>
        <div class="row2">
            <div class="left">总收入 : <span id="benyuemoney"></span>元</div>
            <div class="right">明细</div>
            <div class="clearfix"></div>
        </div>
    </div>

    <ul class="mui-table-view dataList">


    </ul>

<!--    <div id="loadMore">加载更多</div>
    <div id="noMore" class="noMore">没有更多了</div>-->
</div>

<script type="text/html" id="dataTmpl">

    <li class="mui-table-view-cell">
        <a class="">
            片区名称:{{chargingGroupName}} <span class="mui-badge"><b>{{parnterMoney}}</b>元</span>
        </a>
    </li>
</script>

<script type="text/javascript" src="../js/mui.picker.all.js"></script>
<script type="text/javascript">
    mui.init();

    if(window.plus){
        pagePlusReady();
    }else{
        document.addEventListener('plusready',pagePlusReady,false);
    }

    function pagePlusReady(){
        checkLogin();

        getList();

    }

    function getList(){
        var uuid = plus.storage.getItem("uuid");
        var month = plus.storage.getItem("month");
        var parnterMoney = plus.storage.getItem("parnterMoney");
        var year =  new Date().getFullYear();

        $("#benyuemoney").text(parnterMoney);
        $(".selectDate span").text(year+"年"+month+"月");

        var dataParam = {
            "uuid":uuid,
            "month":month,
            "year":year
        }
        console.log("getList:year:"+year);
        console.log("getList:UUid:"+uuid);
        console.log("getList:month:"+month);
        console.log("getList:parnterMoney:"+parnterMoney);
        postJSON(API_URL.ApiChargingBusinessGetAMonthlyIncomeDetail,dataParam,function(res){
            if("0" == res.code){
                var data = res.data.listRet;
                var tmpl = $("#dataTmpl").html();
                var html = '';
                var htmlNow = '';
                $.each(data, function(index,item) {
                    var parnterMoney = item.parnterMoney;
                    var chargingGroupName = item.chargingGroupName;
                    html += tmpl.replace(/{{parnterMoney}}/g,parnterMoney)
                        .replace(/{{chargingGroupName}}/g,chargingGroupName);
                });
                $(".dataList").html("");
                $(".dataList").append(html);
            }else{
                layer.msg(res.msg);
            }
        })
    }




    $(".selectDate").click(function () {
        var options = {
            'type':'month'
        }
        var dtPicker = new mui.DtPicker(options);
        dtPicker.show(function (selectItems) {
            console.log(selectItems.y);//{text: "2016",value: 2016}
            console.log(selectItems.m);//{text: "05",value: "05"}
            var uuid = plus.storage.getItem("uuid");
            var month = selectItems.m.value;
            var year = selectItems.y.value;
            $(".selectDate span").text(year+"年"+month+"月");

            postJSON(API_URL.ApiChargingBusinessGetAMonthlyIncomeDetail,dataParam,function(res){
                if("0" == res.code){
                    var parnterMoneyToTal = res.data.parnterMoneyToTal;
                    var data = res.data.listRet;
                    var tmpl = $("#dataTmpl").html();
                    var html = '';
                    var htmlNow = '';
                    $.each(data, function(index,item) {
                        var parnterMoney = item.parnterMoney;
                        var chargingGroupName = item.chargingGroupName;
                        html += tmpl.replace(/{{parnterMoney}}/g,parnterMoney)
                            .replace(/{{chargingGroupName}}/g,chargingGroupName);
                    });
                    $("#benyuemoney").text(parnterMoneyToTal);
                    $(".dataList").html("");
                    $(".dataList").append(html);
                }else{
                    layer.msg(res.msg);
                }
            })




        })
    })
</script>
</body>
</html>