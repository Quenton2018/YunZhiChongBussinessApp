<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>申请列表</title>
    <link rel="stylesheet" href="../../css/mui.min.css">
    <link rel="stylesheet" href="../../css/iconfont.css">
    <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8"/>
    <link rel="stylesheet" href="plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
    <script src="../../js/jquery-3.3.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../plugins/layer/layer.js"></script>
    <script src="../../js/hammer.min.js"></script>
    <script src="../../js/jquery.hammer.js"></script>
    <script src="../../js/common.js"></script>
    <script src="../../js/base.js"></script>
    <script src="../../js/mui.min.js"></script>
    <style type="text/css">
        *{
            margin: 0;
            padding: 0;
            text-decoration: none;
            list-style: none;
            font-weight: normal;
            border-style: none;
        }
        img{display: block;}
        body{background:#ececec;}
        .top{
            width: 100%;
            height: 44px;
            background:white;
            font-size: 16px;
            color:white;
            text-align: center;
            line-height: 44px;
            box-shadow: none;
        }
        .top .left{
            float: left;
            padding-left: 30px;
            background: url("../../images/pianqushenqing/faihui@3x.png") 15px center no-repeat;
            background-size: 12px 20px;
            height: 44px;
        }
        .top h1{
            z-index: -100;
            margin: 0;
            padding: 0;
            color: black;
        }
        .conbox01{
            margin-top: 64px;
        }
        .conbox{
            margin-bottom: 20px;
        }
        .box01{
            background: white;
            border-bottom:1px #f0f1f3 dashed;
            padding:10px 15px;
        }
        .box01 .imgbox{
            float: left;
            width:20px;
        }
        .imgbox img{
            width: 100%;
        }
        .box01 h1{
            margin: 0;
            padding: 0;
            float: left;
            color: black;
            font-size:15px;
            line-height: 20px;
            margin-left: 15px;
        }
        .box01 .zhuangtai02{
            float: right;
            background-color: rgb(229, 247, 255);
            width:65px;
            height: 20px;
            font-size: 12px;
            color: rgb(33, 181, 255);
            text-align: center;
            border-radius: 10px;
        }
        .box01 .zhuangtai01{
            float: right;
            width:65px;
            height: 20px;
            font-size: 12px;
            text-align: center;
            border-radius: 10px;
            color: rgb(255, 109, 34);
            background-color: rgb(255, 242, 229);
        }
        .box01 .zhuangtai03{
            float: right;
            width:65px;
            height: 20px;
            font-size: 12px;
            text-align: center;
            border-radius: 10px;
            color: #ff2121;
            background-color:#ffe6e6;
        }
        .box02{
            background: white;
            padding: 10px 15px;
        }
        .box02 h1{
            margin: 0;
            padding: 0;
            font-size: 14px;
            color: black;
            line-height:30px;
        }
        .dbbt{
            background-image: -moz-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
            background-image: -webkit-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
            background-image: -ms-linear-gradient( 135deg, rgb(240,130,0) 0%, rgb(255,117,70) 100%);
            height: 49px;
            text-align: center;
            color: white;
            font-size:16px;
            line-height: 49px;
            box-shadow: none;
        }

        .loadMore{
            text-align: center;
            background: #fff;
            padding: 10px;
            display: none;
        }
    </style>

</head>
<body>

    <header class="top mui-bar mui-bar-nav">
        <div class="left mui-action-back"></div>
        <h1 class="mui-title">申请列表</h1>
    </header>

    <div class="conbox01" id="dataListBox">

    </div>

    <div class="loadMore" id="loadMore">加载更多</div>

    <div class="dbbt mui-bar mui-bar-tab" onclick="clicked('apply.html')">
        申请充电桩
    </div>

    <script type="text/html" id="dataTmpl">
        <div class="conbox" onclick="clicked('detail.html?id={{id}}')">
            <div class="box01">
                <div class="imgbox">
                    <img src="../../images/pianqushenqing/pianqu@3x.png">
                </div>
                <h1>申请充电桩数量：<span style="color: rgb(255, 109, 34); ">{{totalCount}}</span>（实际{{realCount}}台）</h1>
                <div class="{{zhuangtai}}">{{status}}</div>
                <div class="clearfix"></div>
            </div>
            <div class="box02">
                <h1>收货人电话：{{mobile}}</h1>
                <h1>地址：{{address}}</h1>
                <h1>申请时间：{{createDate}}</h1>
                <h1>快递单号：{{expressInfo}}</h1>
            </div>
        </div>
    </script>

    <script type="application/javascript">

        var pageNumber = 1;
        var pageSize = 10;

        var ws=null;
        var uuid = null;

        var $dataListBox = $("#dataListBox");

        var topoffset=0;
        var ms=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);
        if(ms&&ms.length>=3){
            topoffset=parseFloat(ms[2]);
        }

        if(window.plus){
            pagePlusReady();
        }else{
            document.addEventListener('plusready',pagePlusReady,false);
        }

        function pagePlusReady() {

            uuid = plus.storage.getItem("uuid");

            getPageData();

            ws=plus.webview.currentWebview();
            if(plus.navigator.isImmersedStatusbar()){// 兼容沉浸式状态栏模式
                topoffset=Math.round(plus.navigator.getStatusbarHeight());
            }
            ws.setPullToRefresh({support:true,style:'circle',offset:topoffset+45+'px'},onRefresh);

        }

        // 刷新页面
        function onRefresh(){

            pageNumber = 1;
            getPageData();

            ws.endPullToRefresh();
        }

        
        function getPageData() {

            var data = {
                'uuid':uuid,
                'pageSize':pageSize,
                'pageNumber':pageNumber
            }

            postJSON(API_URL.ApiApplyCdzList,data,function (res) {

                if(1 == pageNumber){
                    $dataListBox.html('');
                }

                if('0' == res.code){

                    if(res.data.pagedata.last){
                        $("#loadMore").css("display",'none');
                    }else{
                        $("#loadMore").css("display",'block');
                    }

                    var data = res.data.pagedata.content;

                    var html = '';
                    var tmpl = $("#dataTmpl").html();

                    $.each(data,function (index,item) {

                        var expressInfo = '暂无';
                        if(vaildeParam(item.expressInfo)){
                            expressInfo = item.expressInfo;
                        }

                        var zhuangtai = 'zhuangtai02'


                        if('驳回' == item.status){
                            zhuangtai = 'zhuangtai03'
                        }

                        html += tmpl.replace(/{{totalCount}}/g,item.totalCount)
                            .replace(/{{id}}/g,item.id)
                            .replace(/{{realCount}}/g,item.realCount)
                            .replace(/{{status}}/g,item.status)
                            .replace(/{{mobile}}/g,item.mobile)
                            .replace(/{{address}}/g,item.address)
                            .replace(/{{createDate}}/g,new Date(item.createDate).format("yyyy-MM-dd hh:mm:ss"))
                            .replace(/{{expressInfo}}/g,expressInfo)
                            .replace(/{{zhuangtai}}/g,zhuangtai)

                    })

                    $dataListBox.append(html);


                }else{
                    layer.msg(res.msg);
                }

            })
        }


        $("#loadMore").click(function () {
            pageNumber++;
            getPageData();
        })


    </script>
</body>
</html>